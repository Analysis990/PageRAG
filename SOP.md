# PageRAG - å®Œæ•´å•Ÿå‹•èˆ‡æ“ä½œæ¨™æº–ä½œæ¥­ç¨‹åº (SOP)

æœ¬æ–‡ä»¶æä¾›å°ˆæ¡ˆå¾ç’°å¢ƒå»ºç«‹ã€æœå‹™å•Ÿå‹•åˆ°è³‡æ–™è™•ç†èˆ‡åŠŸèƒ½æ¸¬è©¦çš„å®Œæ•´æµç¨‹ã€‚

---

## ğŸ“‹ 1. å‰ç½®éœ€æ±‚æª¢æŸ¥æ¸…å–®

è«‹ç¢ºä¿æ‚¨çš„é›»è…¦å·²å®‰è£ä»¥ä¸‹å·¥å…·ï¼š

- [ ] **Python 3.10+** (ç”¨æ–¼æ‰‹å‹•åŸ·è¡Œè³‡æ–™è™•ç†è…³æœ¬)
- [ ] **Docker & Docker Desktop** (ç”¨æ–¼åŸ·è¡Œå¾Œç«¯æœå‹™èˆ‡è³‡æ–™åº«)
- [ ] **OpenAI API Key** (å¿…é ˆå…·å‚™ API å­˜å–æ¬Šé™)
- [ ] **Git** (é¸é…ï¼Œç”¨æ–¼ç‰ˆæœ¬ç®¡ç†)

---

## âš™ï¸ 2. åˆå§‹ç’°å¢ƒè¨­å®š (åƒ…éœ€åŸ·è¡Œä¸€æ¬¡)

### 2.1 å–å¾—å°ˆæ¡ˆèˆ‡è¨­å®šè®Šæ•¸
```bash
# 1. è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env

# 2. ç·¨è¼¯ .env æª”æ¡ˆ
# è«‹å¡«å…¥æ‚¨çš„ OpenAI API Keyï¼Œä¸¦å¯é¸è¨­å®šæ¨¡å‹èˆ‡ç«¯é»
```

**.env é—œéµæ¬„ä½èªªæ˜ï¼š**
```env
OPENAI_API_KEY=sk-proj-xxxxxx...  # æ­£å¼çš„ OpenAI é‡‘é‘°
CHATGPT_API_KEY=sk-proj-xxxxxx... # èˆ‡ä¸Šé¢ç›¸åŒ (PageIndex ä½¿ç”¨)

# æ¨¡å‹é¸æ“‡ (é¸é…ï¼Œé è¨­ç‚º gpt-3.5-turboï¼Œå»ºè­°ç”¨ gpt-4o-mini æˆ– gpt-4o ä»¥ç²å¾—æ›´å¥½æ•ˆæœ)
OPENAI_MODEL=gpt-4o-mini 

# è‡ªå®šç¾©ç«¯é» (é¸é…ï¼Œè‹¥ä½¿ç”¨å…¬å¸å…§éƒ¨ä»£ç†æˆ–ç¬¬ä¸‰æ–¹ç«¯é»)
# OPENAI_BASE_URL=https://your-company-api.com/v1
```

### 2.2 å»ºç«‹èˆ‡å•Ÿå‹•è™›æ“¬ç’°å¢ƒ (å»ºè­°ä½¿ç”¨)

**Mac / Linux:**
```bash
python3 -m venv venv
source venv/bin/activate
```

**Windows:**
```powershell
python -m venv venv
.\venv\Scripts\activate
```

å•Ÿå‹•å¾Œå®‰è£å¿…è¦å¥—ä»¶ï¼š
```bash
pip install -r requirements.txt
```

---

## ğŸ³ 3. ä½¿ç”¨ Docker Compose å•Ÿå‹•æœå‹™

å•Ÿå‹•å¾Œç«¯ FastAPI æœå‹™èˆ‡ Qdrant å‘é‡è³‡æ–™åº«ã€‚

### 3.1 å•Ÿå‹•æŒ‡ä»¤
```bash
cd docker
docker compose down
docker compose build --no-cache
docker compose up -d
```
> ğŸ’¡ è‹¥ä¹‹å‰æœ‰æ®˜ç•™å®¹å™¨ï¼Œå¯å…ˆåŸ·è¡Œ `docker compose down` æ¸…é™¤ã€‚

æª¢æŸ¥å¾Œç«¯æ—¥èªŒï¼š
```bash
docker logs pagerag-backend
```

### 3.2 é©—è­‰æœå‹™æ˜¯å¦æ­£å¸¸
- **å¾Œç«¯ Web ä»‹é¢**: é–‹å•Ÿç€è¦½å™¨è¨ªå• [http://localhost:8000](http://localhost:8000)
- **Qdrant ç®¡ç†ä»‹é¢**: é–‹å•Ÿç€è¦½å™¨è¨ªå• [http://localhost:6333/dashboard](http://localhost:6333/dashboard)

---

## ğŸ“Š 4. è³‡æ–™è™•ç†è…³æœ¬ (æ ¸å¿ƒåŠŸèƒ½)

å°ˆæ¡ˆæ”¯æ´å…©ç¨®ä¸åŒçš„è³‡æ–™è™•ç†æ–¹å¼ã€‚

### 4.1 RAG ä¸€èˆ¬æª¢ç´¢ (å°‡ .txt è½‰ç‚ºå‘é‡)
å°‡æ–‡å­—æª”æ¡ˆå­˜å…¥å‘é‡è³‡æ–™åº«ï¼Œä¾›ã€Œä¸€èˆ¬èŠå¤©ã€ä½¿ç”¨ã€‚

1. å°‡ `.txt` æª”æ¡ˆæ”¾å…¥ `data/rag_source/`
2. åœ¨æ ¹ç›®éŒ„åŸ·è¡Œï¼š
   ```bash
   python scripts/process_rag.py
   ```
3. æˆåŠŸå¾Œï¼Œæ‚¨å¯ä»¥åœ¨ Qdrant æ§åˆ¶å°çœ‹åˆ°æ–°å»ºç«‹çš„ `rag_documents` é›†åˆã€‚

### 4.2 PageIndex æ¨¹ç‹€ç´¢å¼• (å°‡ PDF è½‰ç‚ºéšå±¤åœ–)
é‡å°é•·ç¯‡ PDFï¼Œç”Ÿæˆçµæ§‹åŒ–å°èˆªç´¢å¼•ï¼Œä¾›ã€ŒFind Documentsã€ä½¿ç”¨ã€‚

1. å°‡ `.pdf` æª”æ¡ˆæ”¾å…¥ `lib/PageIndex/tests/pdfs/`
2. åœ¨æ ¹ç›®éŒ„åŸ·è¡Œï¼š
   ```bash
   python scripts/process_pageindex.py
   ```
3. è™•ç†å®Œæˆå¾Œï¼Œç´¢å¼• JSON æœƒå„²å­˜åœ¨ `lib/PageIndex/tests/results/`ã€‚

---

## ğŸ’¬ 5. åŠŸèƒ½æ¸¬è©¦æŒ‡å—

### 5.1 ä¸€èˆ¬èŠå¤©æ¨¡å¼ (RAG)
- **æƒ…å¢ƒ A (æœ‰è³‡æ–™)**ï¼šè‹¥å·²åŸ·è¡Œ `process_rag.py`ï¼ŒAI æœƒå„ªå…ˆæª¢ç´¢å…§å®¹å›ç­”ï¼Œä¸¦é™„ä¸Šä¾†æºæª”æ¡ˆåç¨±ã€‚
- **æƒ…å¢ƒ B (æ²’è³‡æ–™)**ï¼šç³»çµ±æœƒè‡ªå‹•åˆ‡æ›ç‚ºç›´æ¥ LLM å°è©±æ¨¡å¼ï¼Œæ¨™è¨»ä¾†æºç‚ºã€ŒDirect LLM (No RAG data)ã€ã€‚

### 5.2 æ–‡ä»¶æŸ¥æ‰¾æ¨¡å¼ (PageIndex)
1. åœ¨ç¶²é å·¦æ–¹å·¥å…·é¸å–®é¸æ“‡ **Find Documents (PageIndex)**ã€‚
2. è¼¸å…¥å…·é«”å•é¡Œï¼ˆä¾‹å¦‚ï¼šæ–‡ä»¶çš„ç¬¬ä¸‰ç« åœ¨è¬›ä»€éº¼ï¼Ÿï¼‰ã€‚
3. AI æœƒå°èˆªæ¨¹ç‹€ç´¢å¼•ï¼Œå®šä½åˆ°å…·é«”æ®µè½ä¸¦å›ç­”ã€‚

### 5.3 è‡ªå‹•åŒ–æ–‡ä»¶è™•ç† (é€²éšåŠŸèƒ½)
1. é»æ“Šå°è©±æ¡†ä¸‹æ–¹çš„ **[ä¸Šå‚³]** (é™„ä»¶åœ–ç¤º)ã€‚
2. é¸å–ä¸€å€‹ PDFã€‚
3. **è‡ªå‹•æµç¨‹**ï¼šç³»çµ±æœƒåŒæ­¥å°‡æª”æ¡ˆå­˜å…¥ `lib/PageIndex/tests/pdfs/` ä¸¦è‡ªå‹•è§¸ç™¼è™•ç†è…³æœ¬ã€‚
4. è§€å¯Ÿç¶²é è¨Šæ¯ï¼šæœƒé¡¯ç¤º `âœ… File uploaded and processed successfully!`ã€‚
5. å®Œæˆå¾Œç›´æ¥åˆ‡æ›åˆ° Find Documents æ¨¡å¼å³å¯æœè©²æ–‡ä»¶ã€‚

---

## ï¿½ï¸ 6. ç–‘é›£æ’è§£ (Troubleshooting)

### 6.1 æ¨¡çµ„æ‰¾ä¸åˆ° (ModuleNotFoundError)
è‹¥åœ¨ Docker çœ‹åˆ° `langchain` ç›¸é—œéŒ¯èª¤ï¼Œè«‹å˜—è©¦ï¼š
```bash
cd docker
docker compose build --no-cache
docker compose up -d
```

### 6.2 å®¹å™¨é€£ç·šå¤±æ•—
æª¢æŸ¥ Qdrant ç‹€æ…‹ï¼š
```bash
docker ps
docker logs pagerag-qdrant
```

### 6.3 è³‡æ–™ä¸è¦‹äº† (Reset Database)
è‹¥æƒ³æ¸…ç©ºå‘é‡è³‡æ–™åº«é‡æ–°ä¾†éï¼š
1. `cd docker && docker compose down`
2. `rm -rf ../data/qdrant_data/*`
3. `docker compose up -d`

---

## âœ… 7. å¿«é€Ÿç¶­è­·æŒ‡ä»¤
- **æª¢è¦–å¾Œç«¯æ—¥èªŒ**: `docker logs -f pagerag-backend`
- **é‡å•Ÿå–®ä¸€æœå‹™**: `docker compose restart backend`
- **æ›´æ–°ç›¸ä¾å¥—ä»¶**: ä¿®æ”¹ `requirements.txt` å¾Œï¼Œé‡è¤‡ 3.1 æ­¥é©Ÿä¸¦åŠ  `--build`ã€‚

---
*æ–‡ä»¶æ›´æ–°æ—¥æœŸï¼š2026-02-05*
